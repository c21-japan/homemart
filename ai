#!/bin/bash

GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

# APIキーチェック
if [ -z "$ANTHROPIC_API_KEY" ]; then
    echo -e "${YELLOW}⚠️  APIキーが設定されていません${NC}"
    echo "以下を実行してください："
    echo 'export ANTHROPIC_API_KEY="sk-ant-xxxxx"'
    exit 1
fi

# 質問取得
if [ -z "$1" ]; then
    echo -e "${GREEN}🤖 ホームマート AIアシスタント${NC}"
    echo "使い方: ./ai \"質問\""
    echo "例: ./ai \"URICO計算機能のコードを作って\""
    exit 0
fi

echo -e "${YELLOW}🤔 Claudeに聞いています...${NC}"

# API呼び出し
response=$(curl -s https://api.anthropic.com/v1/messages \
  -H "content-type: application/json" \
  -H "x-api-key: $ANTHROPIC_API_KEY" \
  -H "anthropic-version: 2023-06-01" \
  -d "{
    \"model\": \"claude-3-haiku-20240307\",
    \"max_tokens\": 4000,
    \"messages\": [{
      \"role\": \"user\",
      \"content\": \"$1\"
    }]
  }")

# 結果表示
echo "$response" | grep -o '"text":"[^"]*' | sed 's/"text":"//g' | sed 's/\\n/\n/g' | sed 's/\\"/"/g'
