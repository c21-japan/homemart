#!/bin/bash

GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

# APIã‚­ãƒ¼ãƒã‚§ãƒƒã‚¯
if [ -z "$ANTHROPIC_API_KEY" ]; then
    echo -e "${YELLOW}âš ï¸  APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“${NC}"
    echo "ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š"
    echo 'export ANTHROPIC_API_KEY="sk-ant-xxxxx"'
    exit 1
fi

# è³ªå•å–å¾—
if [ -z "$1" ]; then
    echo -e "${GREEN}ğŸ¤– ãƒ›ãƒ¼ãƒ ãƒãƒ¼ãƒˆ AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ${NC}"
    echo "ä½¿ã„æ–¹: ./ai \"è³ªå•\""
    echo "ä¾‹: ./ai \"URICOè¨ˆç®—æ©Ÿèƒ½ã®ã‚³ãƒ¼ãƒ‰ã‚’ä½œã£ã¦\""
    exit 0
fi

echo -e "${YELLOW}ğŸ¤” Claudeã«èã„ã¦ã„ã¾ã™...${NC}"

# APIå‘¼ã³å‡ºã—
response=$(curl -s https://api.anthropic.com/v1/messages \
  -H "content-type: application/json" \
  -H "x-api-key: $ANTHROPIC_API_KEY" \
  -H "anthropic-version: 2023-06-01" \
  -d "{
    \"model\": \"claude-3-haiku-20240307\",
    \"max_tokens\": 4000,
    \"messages\": [{
      \"role\": \"user\",
      \"content\": \"$1\"
    }]
  }")

# çµæœè¡¨ç¤º
echo "$response" | grep -o '"text":"[^"]*' | sed 's/"text":"//g' | sed 's/\\n/\n/g' | sed 's/\\"/"/g'
